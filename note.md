管道是一种两个进程间进行单向通信的机制。因为管道传递数据的单向性，管道又称为半双工管道。管道的这一特点决定了器使用的局限性。管道是Linux支持的最初Unix IPC形式之一，具有以下特点：
数据只能由一个进程流向另一个进程（其中一个读管道，一个写管道）；如果要进行双工通信，需要建 立两个管道。
管道只能用于父子进程或者兄弟进程间通信。，也就是说管道只能用于具有亲缘关系的进程间通信。

 **注意** ：从管道读数据是一次性操作，数据一旦被读，它就从管道中被抛弃，释放空间以便写更多的数据。

If no data is available, a read on a pipe waits for either data to be written or for all file descrip

tors referring to the write end to be closed; in the latter case, read will return 0, just as if the end of

a data file had been reached

创建管道的系统调用是 `pipe()`，它创建了一对文件描述符：一个用于读，一个用于写。当在shell中使用管道时，shell会自动调用 `pipe()`以及其他一些系统调用来设置进程间的数据流。

以下是管道创建和数据流动的基本步骤：

* **创建管道** ：当用户在shell中输入一个包含管道的命令（如 `cmd1 | cmd2`）时，shell会使用 `pipe()`系统调用创建一个管道。`pipe()`系统调用返回两个文件描述符：一个用于管道的读端，一个用于管道的写端。
* **创建进程** ：接下来，shell使用 `fork()`系统调用创建两个子进程。每个子进程将执行命令链中的一个命令（cmd1和cmd2）。
* **设置文件描述符** ：在执行命令之前，shell会对子进程的文件描述符进行操作，确保cmd1的标准输出（stdout）连接到管道的写端，而cmd2的标准输入（stdin）连接到管道的读端。这通常通过 dup2() 或 close() 系统调用来完成。
* **执行命令** ：然后，shell使用 `exec()`系统调用来替换子进程的内存空间，运行相应的命令。cmd1 进程写入数据到管道的写端，而 cmd2 进程从管道的读端读取数据。
* **数据流动** ：当 cmd1 进程向管道写入数据时，这些数据被缓存在内核中，直到 cmd2 进程从管道读取它们。
  如果管道的写端没有数据可写，cmd2 进程在尝试读取时会阻塞（等待），直到有数据可读。
  如果管道的读端没有进程读取数据，cmd1 进程在写入时会收到一个 SIGPIPE 信号，通常会导致写入进程终止。
* **清理** ：当两个命令都执行完毕后，shell会关闭所有打开的文件描述符，并回收子进程的资源。

复制文件描述符，实质应该理解为:fd句柄原本指向test.file的文件描述结构体，dup()指向完毕后，new_fd句柄也会指向test.file文件描述结构体。所以说对new_fd句柄所指的文件操作，等价于操作test_file文件。
